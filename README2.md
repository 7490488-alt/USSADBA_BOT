–ó–∞–¥–∞—á–∞: –ü–µ—Ä–µ–π—Ç–∏ –æ—Ç –æ–¥–Ω–æ–≥–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∫ —É–º–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –≥–¥–µ –±–æ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É—á–∞—Å—Ç–æ–∫, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ) –∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–º–ø—Ç. –≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É, —Ü–µ–ª–µ–≤–æ–º—É –¥–∏–∞–ª–æ–≥—É, –∫–∞–∫ –≤ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö sales-–±–æ—Ç–∞—Ö.

‚úÖ –ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä—É—Ç–æ?
üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è: –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ü–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
üí¨ –ì–ª—É–±–∏–Ω–∞ –¥–∏–∞–ª–æ–≥–∞: –º–æ–∂–Ω–æ –≤–µ—Å—Ç–∏ —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–ø—Ä–æ–¥–∞–∂–∞, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –∞—Ä–µ–Ω–¥–∞)
üìà –ö–æ–Ω–≤–µ—Ä—Å–∏—è: –ø–æ–≤—ã—à–∞–µ—Ç—Å—è —à–∞–Ω—Å –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–∏–¥
üß† –ì–∏–±–∫–æ—Å—Ç—å: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–∞—Ä–µ–Ω–¥–∞¬ª, ¬´—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ¬ª)
üöÄ –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å: –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω

1. üìÅ –°–æ–∑–¥–∞–π –ø–∞–ø–∫—É —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏
prompts/
‚îú‚îÄ‚îÄ general.txt           # –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ buyer.txt             # –ü–æ–∫—É–ø–∫–∞ —É—á–∞—Å—Ç–∫–∞
‚îú‚îÄ‚îÄ investor.txt          # –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
‚îú‚îÄ‚îÄ partner.txt           # –ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îî‚îÄ‚îÄ prompt_map.json       # –ö–∞—Ä—Ç–∞: –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ ‚Üí –ø—Ä–æ–º–ø—Ç

2. üìÑ –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤:

prompts/buyer.txt
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–µ —É—á–∞—Å—Ç–∫–æ–≤ –≤ ¬´–£—Å–∞–¥—å–±–µ¬ª. –û—Ç–≤–µ—á–∞–π –æ –∑–µ–º–ª–µ, —Ü–µ–Ω–∞—Ö, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö.  
–ì–æ–≤–æ—Ä–∏ –æ –≤—ã–≥–æ–¥–µ, —Ç–∏—à–∏–Ω–µ, —ç–∫–æ–ª–æ–≥–∏–∏.  
–ù–µ —É–ø–æ–º–∏–Ω–∞–π –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –µ—Å–ª–∏ –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç.  
–ú–∞–∫—Å–∏–º—É–º ‚Äî 3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.

prompts/investor.txt
–¢—ã ‚Äî —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∞ ¬´–£—Å–∞–¥—å–±–∞¬ª. –ì–æ–≤–æ—Ä–∏ –æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏, —Å—Ä–æ–∫–∞—Ö –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏, —Ä–∏—Å–∫–∞—Ö, —Å—Ç–∞–≤–∫–∞—Ö.  
–ü—Ä–∏–≤–æ–¥–∏ –ø—Ä–∏–º–µ—Ä—ã: "–ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –∫–æ—Ç—Ç–µ–¥–∂–µ–π ‚Äî –¥–æ—Ö–æ–¥ 8‚Äì12% –≥–æ–¥–æ–≤—ã—Ö".  
–ù–µ —É–≥–ª—É–±–ª—è–π—Å—è –≤ —ç–º–æ—Ü–∏–∏, —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç—ã –∏ —Ü–∏—Ñ—Ä—ã.

prompts/general.txt
–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ ¬´–£—Å–∞–¥—å–±—ã¬ª. –†–∞—Å—Å–∫–∞–∂–∏ –æ –ø—Ä–æ–µ–∫—Ç–µ: 50 –≥–∞, –ª–µ—Å, –æ–∑–µ—Ä–æ, —ç–∫–æ–ª–æ–≥–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.  
–ì–æ–≤–æ—Ä–∏ –ø—Ä–æ—Å—Ç–æ, —Å —Ç–µ–ø–ª–æ—Ç–æ–π.  
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Ç–æ—á–Ω—è–µ—Ç ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∞–π—Å—è –Ω–∞ buyer/investor.

3. üîç –û–ø—Ä–µ–¥–µ–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
–°–æ–∑–¥–∞–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ prompts/prompt_map.json:
{
  "buyer": ["—É—á–∞—Å—Ç–æ–∫", "–∫—É–ø–∏—Ç—å", "–∑–µ–º–ª—è", "–¥–æ–º", "—Å–µ–º—å—è", "–∂–∏—Ç—å", "–¥–µ—Ç–∏", "–ø–æ—Å–µ–ª–∏—Ç—å—Å—è"],
  "investor": ["–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å", "–¥–æ—Ö–æ–¥", "–≤–ª–æ–∂–∏—Ç—å", "—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å", "–ø—Ä–æ–µ–∫—Ç", "–ø—Ä–∏–±—ã–ª—å", "ROI", "–±–∏–∑–Ω–µ—Å"],
  "general": ["—á—Ç–æ —ç—Ç–æ", "—Ä–∞—Å—Å–∫–∞–∂–∏", "–ø—Ä–æ–µ–∫—Ç", "–≥–¥–µ", "–∫—Ç–æ", "–∫–∞–∫", "—á—Ç–æ —Ç–∞–∫–æ–µ"]
}

4. üß† –î–æ–±–∞–≤—å –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞ –≤ services/llm.py
# services/llm.py
import os
import json
from typing import Dict, List

class YandexLLM:
    def __init__(self):
        self.prompts_dir = "prompts"
        self.prompt_map = self._load_prompt_map()
        self.current_prompt = None
        self.current_prompt_name = None

    def _load_prompt_map(self) -> Dict[str, List[str]]:
        with open(os.path.join(self.prompts_dir, "prompt_map.json"), "r", encoding="utf-8") as f:
            return json.load(f)

    def _load_prompt(self, name: str) -> str:
        path = os.path.join(self.prompts_dir, f"{name}.txt")
        try:
            with open(path, "r", encoding="utf-8") as f:
                return f.read().strip()
        except FileNotFoundError:
            return self._load_prompt("general")

    def select_prompt(self, user_message: str) -> str:
        user_message = user_message.lower()
        for prompt_name, keywords in self.prompt_map.items():
            if any(kw in user_message for kw in keywords):
                return self._load_prompt(prompt_name)
        return self._load_prompt("general")  # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

5. üîÑ –û–±–Ω–æ–≤–∏ –º–µ—Ç–æ–¥ chat ‚Äî —á—Ç–æ–±—ã –æ–Ω –≤—ã–±–∏—Ä–∞–ª –ø—Ä–æ–º–ø—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
async def chat(self, user_message: str, history: List[Dict[str, str]]) -> str:
    # –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ–º–ø—Ç –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—é
    sys_prompt = self.select_prompt(user_message)

    messages = [{"role": "system", "text": sys_prompt}]
    for msg in history:
        if msg["role"] in ("user", "assistant"):
            messages.append({
                "role": "user" if msg["role"] == "user" else "assistant",
                "text": msg["content"]
            })
    messages.append({"role": "user", "text": user_message})

    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ –∫ LLM

6. üí° –£–ª—É—á—à–µ–Ω–∏–µ: –∑–∞–ø–æ–º–∏–Ω–∞–π –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 
–î–æ–±–∞–≤—å –≤ context.user_data:
# –í chat.py
if "selected_prompt" not in context.user_data:
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ –ø–µ—Ä–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
    sys_prompt = llm_service.select_prompt(user_message)
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∏–ø
    for name in ["buyer", "investor", "general"]:
        if any(kw in user_message.lower() for kw in llm_service.prompt_map[name]):
            context.user_data["selected_prompt"] = name
            break
    else:
        context.user_data["selected_prompt"] = "general"
else:
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–π
    sys_prompt = llm_service._load_prompt(context.user_data["selected_prompt"])

7. üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ø—Ä–µ–¥–ª–æ–∂–∏ –≤—ã–±–æ—Ä
–ü–æ—Å–ª–µ /start –±–æ—Ç –º–æ–∂–µ—Ç —Å–ø—Ä–æ—Å–∏—Ç—å:
await update.message.reply_text(
    "–ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å?"
    "1. –•–æ—á—É –∫—É–ø–∏—Ç—å —É—á–∞—Å—Ç–æ–∫ üè°"
    "2. –ò–Ω—Ç–µ—Ä–µ—Å—É—é—Å—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º–∏ üíº"
    "3. –ü—Ä–æ—Å—Ç–æ —Ö–æ—á—É —É–∑–Ω–∞—Ç—å –æ –ø—Ä–æ–µ–∫—Ç–µ ‚ÑπÔ∏è",
    reply_markup=ReplyKeyboardMarkup([
        ["üè° –£—á–∞—Å—Ç–æ–∫", "üíº –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"],
        ["‚ÑπÔ∏è –†–∞—Å—Å–∫–∞–∂–∏ –æ –ø—Ä–æ–µ–∫—Ç–µ"]
    ], resize_keyboard=True)
)
–ò —Å—Ä–∞–∑—É —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å selected_prompt.

‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
–ú–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–º–ø—Ç–æ–≤
–ì–∏–±–∫–æ—Å—Ç—å –∏ —Ç–æ—á–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤
–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–∏
–ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞
–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥
–ö–Ω–æ–ø–∫–∏
–£–¥–æ–±–Ω—ã–π UX
–õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å
–î–æ–±–∞–≤–ª—è–π –Ω–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: "–∞—Ä–µ–Ω–¥–∞", "—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ" –∏ —Ç.–¥.


üõ† –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Ç–æ–º?
üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏ vs –∏–Ω–≤–µ—Å—Ç–æ—Ä—ã
üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è: "–ê –µ—Å–ª–∏ –ø—Ä–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏?"
üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: "–°–æ–∑–¥–∞–π –º–Ω–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ"
üß© –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM: –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –º–µ–Ω–µ–¥–∂–µ—Ä—É